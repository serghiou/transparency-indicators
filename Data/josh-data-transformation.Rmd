---
title: 'HRP 262: Final'
author: "Stylianos Serghiou"
date: '`r format(Sys.time(), "%d/%m/%Y")`'
output:
  pdf_document:
    df_print: kable
    highlight: tango
    latex_engine: pdflatex
    keep_tex: yes
  tufte::tufte_handout: default
  html_document:
    df_print: kable
    highlight: tango
    theme: paper
    toc: yes
    toc_depth: 2
    toc_float: yes
  rmdformats::readthedown:
    highlight: kate
  tufte::tufte_html: default
header-includes:
- \DeclareUnicodeCharacter{3B8}{~}
- \DeclareUnicodeCharacter{3B1}{~}
- \DeclareUnicodeCharacter{3B2}{~}
- \DeclareUnicodeCharacter{223C}{~}
- \DeclareUnicodeCharacter{2264}{~}
- \DeclareUnicodeCharacter{2265}{~}
- \usepackage{graphicx}
---

<style>
p {

text-align: justify;
text-justify: interword;
padding: 0 0 0.5em 0

}
</style>

```{r knitr, include = FALSE}
# Load packages
library(knitr)
library(rmdformats)
library(kableExtra)
library(ggplot2)
library(magrittr)

# Define chunk options
knitr::opts_chunk$set(echo = TRUE
                      , cache     = TRUE   # thus no need to re-run chunks
                      #, cache.lazy = TRUE #use when have big objects (>1 GB)
                      , cache.comments = FALSE # no rebuild if comments change
                      , tidy      = FALSE  # can play with this
                      , warning   = FALSE 
                      , message   = FALSE
                      , comment   = NA
                      , fig.align = "center"
                      , fig.width = 7
                      , linewidth = 91)

opts_knit$set(width = 75)

# Initiatialize hook
hook_output = knit_hooks$get("output")

# Hook to wrap output text when it exceeds 'n' using linewidth
knit_hooks$set(output = function(x, options) {
  
  if (!is.null(n <- options$linewidth)) {
    x = knitr:::split_lines(x)
    
    # wrap lines wider than 'n' 
    if (any(nchar(x) > n)) 
      x <- strwrap(x, width = n)
      x <- paste(x, collapse = "\n")
  }
  hook_output(x, options)
})

# Load pretty tables for LaTeX (comment out if using HTML)
options(knitr.table.format = "latex")

# Set up preferred theme in ggplot2
my_theme <- 
  # this and theme_minimal() are the best
  theme_light() +  
  theme(plot.title   = element_text(face = "bold"),
        legend.title = element_text(face = "bold"),
        # Avoid borders
        legend.key   = element_rect(colour = NA, fill = NA),  
        axis.text.x  = element_text(margin = margin(b = 10)),
        axis.text.y  = element_text(margin = margin(l = 10)),
        axis.title.y = element_text(colour = "grey25"),
        axis.title.x = element_text(colour = "grey25"))

# Make my theme the default theme
original_theme <- theme_set(my_theme)

# Use ggsave to save plots after plotting - this reduces size dramatically

# For more knitr options visit: https://yihui.name/knitr/options/
# and his github page: https://github.com/yihui/knitr-examples

# To update the package use:
# Replace ~/serghiouTemplates/inst/rmarkdown/templates/report/skeleton.rmd
# library(devtools); setwd("/Users/Stelios/"); install("serghiouTemplates")
```

```{r prep}
library(kableExtra)
library(dplyr)
library(readr)
# a %>% kable(booktabs = T) %>% kable_styling()
```

```{r setup}
dat <- read_excel("josh-raw-data.xlsx", sheet = "541_Final")
```

***

## Transformations

Recode the Replication column into an isNovel column, as defined in the dictionary.

```{r}
# Replication to Novel
isNovel <- 
  dat$Replication %>% 
  recode(`0` = 1, `1` = 0, `2` = 1, `3` = 0, `4` = 0, `5` = 2)

# Export
write_csv(data.frame(isNovel), "isNovel.csv")
```

Recode the Replication column into an isReplication column, as defined in the dictionary.

```{r}
# Replication to Novel
isReplication <- 
  dat$Replication %>% 
  recode(`0` = 0, `1` = 1, `2` = 1, `3` = 0, `4` = 1, `5` = 2)

# Export
write_csv(data.frame(isReplication), "isReplication.csv")
```

Recode the Replication_Abstract column into an isReplicationAbstract column, as defined in the dictionary.

```{r}
# Replication to Novel
isReplicationAbstract <- 
  dat$Replication_abstract %>% 
  recode(`0` = 88, `1` = 1, `2` = 0, `3` = 0)

# Export
write_csv(data.frame(isReplication), "isReplicationAbstract.csv")
```


```{r}
library(microbenchmark)
microbenchmark(a = recode(x, `4` = 2, `3` = 4, `5` = 6), b = case_when(x == 4 ~ 2, x == 3 ~ 4, x == 5 ~ 6, TRUE ~ as.numeric(x)))
```

***

***

## Save

```{r save}
# Save
save(list = ls(), file = "output.RData")
```

***

## Documentation

## Session Info

```{r session_info}
print(sessionInfo(), locale = F)
```

## References

```{r refs}
(.packages()) %>% sort %>% lapply(citation) %>% lapply(c) %>% unique
```
